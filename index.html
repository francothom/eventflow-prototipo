<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Gestión de Eventos - Prototipo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .dragging {
            opacity: 0.4;
            transform: scale(1.05);
        }
        .drag-over {
            background-color: #c7d2fe; /* Indigo-200 */
            border: 2px dashed #6366f1; /* Indigo-500 */
        }
        .kanban-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }
        .hidden { display: none; }
        .card-actions { opacity: 0; transition: opacity 0.2s ease-in-out; }
        .kanban-card:hover .card-actions { opacity: 1; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-gray-900">Event<span class="text-indigo-600">Flow</span></h1>
            <div class="flex items-center space-x-4">
                <span class="text-sm">Hola, Organizador</span>
                <img class="h-10 w-10 rounded-full object-cover" src="https://placehold.co/100x100/6366f1/ffffff?text=O" alt="Avatar del organizador">
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 md:p-6">
        <div class="mb-6">
            <h2 class="text-3xl font-bold text-gray-800">Congreso Anual de Tecnología 2025</h2>
            <p class="text-gray-600">Gestiona todas las etapas de tu evento en un solo lugar.</p>
        </div>

        <div class="flex flex-col lg:flex-row gap-6">

            <!-- Kanban Board -->
            <div class="w-full lg:w-3/4">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Tablero de Tareas</h3>
                <div id="kanban-board" class="grid grid-cols-1 md:grid-cols-3 gap-6 items-start">
                    <!-- Columna "Por Hacer" -->
                    <div class="bg-gray-200 rounded-lg p-4 flex flex-col">
                        <h4 class="font-bold text-lg mb-4 text-gray-800">Por Hacer</h4>
                        <div class="space-y-4 task-list min-h-[200px] flex-grow" data-column-id="todo"></div>
                        <button class="add-task-btn mt-4 w-full bg-indigo-200 text-indigo-800 py-2 rounded-lg hover:bg-indigo-300 transition">+ Añadir Tarea</button>
                    </div>
                    <!-- Columna "En Progreso" -->
                    <div class="bg-gray-200 rounded-lg p-4 flex flex-col">
                        <h4 class="font-bold text-lg mb-4 text-gray-800">En Progreso</h4>
                        <div class="space-y-4 task-list min-h-[200px] flex-grow" data-column-id="inprogress"></div>
                        <button class="add-task-btn mt-4 w-full bg-indigo-200 text-indigo-800 py-2 rounded-lg hover:bg-indigo-300 transition">+ Añadir Tarea</button>
                    </div>
                    <!-- Columna "Hecho" -->
                    <div class="bg-gray-200 rounded-lg p-4 flex flex-col">
                        <h4 class="font-bold text-lg mb-4 text-gray-800">Hecho</h4>
                        <div class="space-y-4 task-list min-h-[200px] flex-grow" data-column-id="done"></div>
                        <button class="add-task-btn mt-4 w-full bg-indigo-200 text-indigo-800 py-2 rounded-lg hover:bg-indigo-300 transition">+ Añadir Tarea</button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="w-full lg:w-1/4 space-y-6">
                 <!-- AI Assistant -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h4 class="font-semibold text-lg mb-3">Sugerencias asistente IA</h4>
                    <div class="space-y-3 text-sm">
                        <div class="bg-indigo-100 border-l-4 border-indigo-500 text-indigo-700 p-3 rounded">
                            <p class="font-bold">Sugerencia:</p>
                            <p>El catering aún no está confirmado y faltan 15 días. ¿Quieres que envíe un recordatorio?</p>
                        </div>
                        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 rounded">
                            <p class="font-bold">Alerta de Presupuesto:</p>
                            <p>Has gastado el 85% del presupuesto de marketing. ¿Deseas reasignar fondos?</p>
                        </div>
                    </div>
                </div>
                 <!-- Invitations & QR -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h4 class="font-semibold text-lg mb-3">Invitaciones</h4>
                    <button id="generate-qr-btn" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">Generar QR de Invitación</button>
                    <div id="qr-container" class="mt-4 text-center hidden">
                        <canvas id="qr-code" class="mx-auto"></canvas>
                        <p class="text-xs text-gray-500 mt-2">Escanea para registrarte</p>
                        <a id="whatsapp-share-btn" href="#" target="_blank" class="mt-2 w-full bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition inline-flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.58-1.452l-6.341 1.693zm5.423-4.825l.325.195c1.523.912 3.283 1.401 5.12 1.401 5.478 0 9.92-4.442 9.922-9.919.002-5.478-4.44-9.92-9.919-9.92-5.478 0-9.92 4.442-9.922 9.92-.001 2.021.59 3.927 1.696 5.613l.215.324-1.123 4.096 4.185-1.11z"/></svg>
                            Compartir por WhatsApp
                        </a>
                    </div>
                </div>
                <!-- Provider Hub -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h4 class="font-semibold text-lg mb-3">Hub de Proveedores</h4>
                    <p class="text-sm mb-2">Comparando cotizaciones para "Catering":</p>
                    <div class="space-y-2 text-sm">
                        <div class="border p-2 rounded">
                            <p class="font-semibold">Gourmet Express - $4,500 <span class="text-green-500">(Mejor Precio)</span></p>
                            <p class="text-xs text-gray-500">Evaluación: 4.8/5 ⭐</p>
                        </div>
                        <div class="border p-2 rounded">
                            <p class="font-semibold">Sabores del Sur - $5,200</p>
                            <p class="text-xs text-gray-500">Evaluación: 4.9/5 ⭐</p>
                        </div>
                    </div>
                     <button id="open-providers-modal" class="mt-4 w-full bg-gray-200 text-gray-800 py-2 rounded-lg hover:bg-gray-300 transition">Ver todos los proveedores</button>
                </div>
                <!-- Guest Management -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h4 class="font-semibold text-lg mb-3">Gestión de Invitados</h4>
                    <ul class="space-y-2 text-sm">
                        <li class="flex justify-between items-center"><span>Total Invitados:</span> <span class="font-bold">400</span></li>
                        <li class="flex justify-between items-center"><span>Confirmados:</span> <span class="font-bold text-green-600">215</span></li>
                    </ul>
                    <button id="open-guests-modal" class="mt-4 w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition">Ver Lista Completa</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Chat Widget -->
    <div class="fixed bottom-6 right-6 flex flex-col items-end space-y-4 z-50">
        <!-- Chat Window -->
        <div id="chat-widget" class="w-80 md:w-96 h-[500px] bg-white rounded-lg shadow-xl flex-col transition-all duration-300 ease-in-out opacity-0 transform translate-y-4 pointer-events-none hidden">
            <!-- Header -->
            <div class="flex justify-between items-center p-3 border-b bg-indigo-600 text-white rounded-t-lg">
                <h3 class="text-lg font-semibold">Asistente Virtual</h3>
                <button id="close-chat-widget" class="text-white opacity-70 hover:opacity-100 text-2xl">&times;</button>
            </div>
            <!-- Messages -->
            <div id="chat-messages" class="p-4 flex-1 overflow-y-auto space-y-4">
                 <div class="flex justify-start"><div class="bg-gray-200 rounded-lg p-3 max-w-xs">Hola, soy tu asistente IA. ¿Cómo puedo ayudarte?</div></div>
            </div>
            <!-- Input -->
            <div class="p-3 border-t bg-gray-50"><div class="flex space-x-2"><input id="chat-input" type="text" placeholder="Escribe tu mensaje..." class="flex-1 border rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500"><button id="chat-send" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">Enviar</button></div></div>
        </div>
        
        <!-- Floating Button -->
        <button id="chat-toggle-btn" class="bg-indigo-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-lg hover:bg-indigo-700 transition transform hover:scale-110">
            <svg id="chat-icon-open" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
            <svg id="chat-icon-close" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
    </div>
    
    <!-- MODALS -->
    <!-- Add Task Modal -->
    <div id="add-task-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-md transform scale-95">
            <div class="p-6">
                <h3 class="text-xl font-semibold mb-4">Añadir Nueva Tarea</h3>
                <form id="add-task-form">
                    <div class="mb-4">
                        <label for="add-task-title" class="block text-sm font-medium text-gray-700">Título</label>
                        <input type="text" id="add-task-title" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="add-task-description" class="block text-sm font-medium text-gray-700">Descripción</label>
                        <textarea id="add-task-description" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="add-task-category" class="block text-sm font-medium text-gray-700">Categoría</label>
                        <select id="add-task-category" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="Logística">Logística</option>
                            <option value="Comunicación">Comunicación</option>
                            <option value="Proveedores">Proveedores</option>
                            <option value="Urgente">Urgente</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" class="close-modal-btn bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">Añadir</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Edit Task Modal -->
    <div id="edit-task-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-md transform scale-95">
            <div class="p-6">
                <h3 class="text-xl font-semibold mb-4">Editar Tarea</h3>
                <form id="edit-task-form">
                    <input type="hidden" id="edit-task-id">
                    <div class="mb-4">
                        <label for="edit-task-title" class="block text-sm font-medium text-gray-700">Título</label>
                        <input type="text" id="edit-task-title" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="edit-task-description" class="block text-sm font-medium text-gray-700">Descripción</label>
                        <textarea id="edit-task-description" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="edit-task-category" class="block text-sm font-medium text-gray-700">Categoría</label>
                        <select id="edit-task-category" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="Logística">Logística</option>
                            <option value="Comunicación">Comunicación</option>
                            <option value="Proveedores">Proveedores</option>
                            <option value="Urgente">Urgente</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" class="close-modal-btn bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Guests Modal -->
    <div id="guests-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col transform scale-95">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-xl font-semibold">Lista de Invitados</h3>
                <button class="close-modal-btn text-gray-500 hover:text-gray-800 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-100"><tr><th class="p-2">Nombre</th><th class="p-2">Email</th><th class="p-2">Estado</th></tr></thead>
                    <tbody>
                        <tr class="border-b"><td class="p-2">Ana Pérez</td><td class="p-2">ana.perez@email.com</td><td class="p-2"><span class="bg-green-200 text-green-800 px-2 py-1 rounded-full">Confirmado</span></td></tr>
                        <tr class="border-b"><td class="p-2">Carlos Rodriguez</td><td class="p-2">c.rod@email.com</td><td class="p-2"><span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full">Pendiente</span></td></tr>
                        <tr class="border-b"><td class="p-2">Mariana López</td><td class="p-2">m.lopez@email.com</td><td class="p-2"><span class="bg-green-200 text-green-800 px-2 py-1 rounded-full">Confirmado</span></td></tr>
                        <tr class="border-b"><td class="p-2">Jorge Fernandez</td><td class="p-2">jorge.f@email.com</td><td class="p-2"><span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full">Pendiente</span></td></tr>
                        <tr class="border-b"><td class="p-2">Laura Sanchez</td><td class="p-2">laura.s@email.com</td><td class="p-2"><span class="bg-green-200 text-green-800 px-2 py-1 rounded-full">Confirmado</span></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Providers Modal -->
    <div id="providers-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col transform scale-95">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-xl font-semibold">Lista de Proveedores</h3>
                <button class="close-modal-btn text-gray-500 hover:text-gray-800 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-100"><tr><th class="p-2">Proveedor</th><th class="p-2">Categoría</th><th class="p-2">Contacto</th><th class="p-2">Evaluación</th></tr></thead>
                    <tbody id="providers-table-body">
                        <!-- Provider rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let draggedItem = null;
        let currentTargetColumnId = null;

        const categoryStyles = {
            'Urgente': 'bg-red-200 text-red-800',
            'Comunicación': 'bg-blue-200 text-blue-800',
            'Logística': 'bg-yellow-200 text-yellow-800',
            'Proveedores': 'bg-green-200 text-green-800',
            'Completado': 'bg-gray-400 text-white line-through'
        };

        function createTaskCard(id, title, description, category) {
            const card = document.createElement('div');
            card.className = 'bg-white p-3 rounded-lg shadow-sm cursor-grab kanban-card relative';
            card.setAttribute('draggable', 'true');
            card.dataset.taskId = id;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'pr-8';

            const titleP = document.createElement('p');
            titleP.className = 'font-semibold text-sm task-title';
            titleP.textContent = title;

            const descriptionP = document.createElement('p');
            descriptionP.className = 'text-xs text-gray-600 mt-1 task-description';
            descriptionP.textContent = description;

            const categorySpan = document.createElement('span');
            categorySpan.className = `text-xs px-2 py-1 rounded-full mt-2 inline-block task-category`;
            categorySpan.textContent = category;
            const styleClasses = categoryStyles[category] || categoryStyles['Logística'];
            categorySpan.classList.add(...styleClasses.split(' '));
            
            contentDiv.appendChild(titleP);
            contentDiv.appendChild(descriptionP);
            contentDiv.appendChild(categorySpan);
            
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'card-actions absolute top-2 right-2 flex flex-col space-y-1';

            const editBtn = document.createElement('button');
            editBtn.className = 'edit-task-btn text-gray-400 hover:text-blue-500';
            editBtn.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>';
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-task-btn text-gray-400 hover:text-red-500';
            deleteBtn.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>';
            
            actionsDiv.appendChild(editBtn);
            actionsDiv.appendChild(deleteBtn);

            card.appendChild(contentDiv);
            card.appendChild(actionsDiv);

            return card;
        }

        function setupKanbanBoard() {
            const kanbanBoard = document.getElementById('kanban-board');

            kanbanBoard.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('kanban-card')) {
                    draggedItem = e.target;
                    setTimeout(() => e.target.classList.add('dragging'), 0);
                }
            });

            kanbanBoard.addEventListener('dragend', () => {
                if (draggedItem) {
                    draggedItem.classList.remove('dragging');
                    draggedItem = null;
                }
            });
            
            kanbanBoard.addEventListener('dragover', (e) => {
                const column = e.target.closest('.task-list');
                if (column) {
                    e.preventDefault();
                    column.classList.add('drag-over');
                }
            });

            kanbanBoard.addEventListener('dragleave', (e) => {
                const column = e.target.closest('.task-list');
                if (column) column.classList.remove('drag-over');
            });

            kanbanBoard.addEventListener('drop', (e) => {
                e.preventDefault();
                const column = e.target.closest('.task-list');
                if (column && draggedItem) {
                    column.appendChild(draggedItem);
                    column.classList.remove('drag-over');
                }
            });

            kanbanBoard.addEventListener('click', e => {
                const deleteBtn = e.target.closest('.delete-task-btn');
                if (deleteBtn) {
                    deleteBtn.closest('.kanban-card').remove();
                    return;
                }
                
                const editBtn = e.target.closest('.edit-task-btn');
                if (editBtn) {
                    const card = editBtn.closest('.kanban-card');
                    const taskId = card.dataset.taskId;
                    const title = card.querySelector('.task-title').textContent;
                    const description = card.querySelector('.task-description').textContent;
                    const category = card.querySelector('.task-category').textContent;

                    document.getElementById('edit-task-id').value = taskId;
                    document.getElementById('edit-task-title').value = title;
                    document.getElementById('edit-task-description').value = description;
                    document.getElementById('edit-task-category').value = category;

                    toggleModal(modals.editTask, true);
                }
            });
        }
        
        const modals = {
            addTask: document.getElementById('add-task-modal'),
            editTask: document.getElementById('edit-task-modal'),
            guests: document.getElementById('guests-modal'),
            providers: document.getElementById('providers-modal')
        };

        function toggleModal(modal, show) {
            if (!modal) return;
            const content = modal.querySelector('.modal-content');
            if (show) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    if (content) content.classList.remove('scale-95');
                }, 10);
            } else {
                modal.classList.add('opacity-0');
                if (content) content.classList.add('scale-95');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function setupModals() {
            document.querySelectorAll('.add-task-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentTargetColumnId = btn.closest('.flex.flex-col').querySelector('.task-list').dataset.columnId;
                    toggleModal(modals.addTask, true);
                    modals.addTask.querySelector('#add-task-title').focus();
                });
            });

            document.getElementById('open-guests-modal').addEventListener('click', () => toggleModal(modals.guests, true));
            document.getElementById('open-providers-modal').addEventListener('click', () => toggleModal(modals.providers, true));

            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', e => {
                    if (e.target === overlay) toggleModal(overlay, false);
                });
            });
            document.querySelectorAll('.close-modal-btn').forEach(btn => {
                btn.addEventListener('click', () => toggleModal(btn.closest('.modal-overlay'), false));
            });

            document.getElementById('add-task-form').addEventListener('submit', e => {
                e.preventDefault();
                const title = document.getElementById('add-task-title').value;
                const description = document.getElementById('add-task-description').value;
                const category = document.getElementById('add-task-category').value;
                if (title.trim() && currentTargetColumnId) {
                    const newCard = createTaskCard(Date.now(), title, description, category);
                    document.querySelector(`.task-list[data-column-id="${currentTargetColumnId}"]`).appendChild(newCard);
                    e.target.reset();
                    toggleModal(modals.addTask, false);
                }
            });
            
            document.getElementById('edit-task-form').addEventListener('submit', e => {
                e.preventDefault();
                const taskId = document.getElementById('edit-task-id').value;
                const newTitle = document.getElementById('edit-task-title').value;
                const newDescription = document.getElementById('edit-task-description').value;
                const newCategory = document.getElementById('edit-task-category').value;

                const cardToEdit = document.querySelector(`[data-task-id="${taskId}"]`);
                if (cardToEdit) {
                    cardToEdit.querySelector('.task-title').textContent = newTitle;
                    cardToEdit.querySelector('.task-description').textContent = newDescription;
                    const categorySpan = cardToEdit.querySelector('.task-category');
                    categorySpan.textContent = newCategory;
                    categorySpan.className = 'text-xs px-2 py-1 rounded-full mt-2 inline-block task-category';
                    categorySpan.classList.add(...(categoryStyles[newCategory] || categoryStyles['Logística']).split(' '));
                }
                toggleModal(modals.editTask, false);
            });
        }

        function setupChatWidget() {
            const toggleBtn = document.getElementById('chat-toggle-btn');
            const chatWidget = document.getElementById('chat-widget');
            const closeBtn = document.getElementById('close-chat-widget');
            const iconOpen = document.getElementById('chat-icon-open');
            const iconClose = document.getElementById('chat-icon-close');

            const toggleChat = (forceOpen = null) => {
                const isOpen = !chatWidget.classList.contains('hidden');
                const open = forceOpen !== null ? forceOpen : !isOpen;

                if (open) {
                    chatWidget.classList.remove('hidden');
                    setTimeout(() => {
                        chatWidget.classList.remove('opacity-0', 'translate-y-4');
                        chatWidget.classList.add('pointer-events-auto');
                    }, 10);
                    iconOpen.classList.add('hidden');
                    iconClose.classList.remove('hidden');
                } else {
                    chatWidget.classList.add('opacity-0', 'translate-y-4');
                    chatWidget.classList.remove('pointer-events-auto');
                    setTimeout(() => chatWidget.classList.add('hidden'), 300);
                    iconOpen.classList.remove('hidden');
                    iconClose.classList.add('hidden');
                }
            }

            toggleBtn.addEventListener('click', () => toggleChat());
            closeBtn.addEventListener('click', () => toggleChat(false));

            const chatInput = document.getElementById('chat-input');
            const chatSend = document.getElementById('chat-send');
            const chatMessages = document.getElementById('chat-messages');
            const addMessage = (text, sender) => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
                messageDiv.innerHTML = `<div class="rounded-lg p-3 max-w-xs ${sender === 'user' ? 'bg-indigo-600 text-white' : 'bg-gray-200'}">${text}</div>`;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            };
            const handleSend = () => {
                if (chatInput.value.trim()) {
                    addMessage(chatInput.value, 'user');
                    chatInput.value = '';
                    setTimeout(() => addMessage("Gracias por tu mensaje. Estoy procesando tu solicitud.", 'bot'), 1000);
                }
            };
            chatSend.addEventListener('click', handleSend);
            chatInput.addEventListener('keypress', e => { if (e.key === 'Enter') handleSend(); });
        }


        function setupInvitations() {
            const qrBtn = document.getElementById('generate-qr-btn');
            qrBtn.addEventListener('click', () => {
                const eventUrl = "https://mi-evento-tech.com/registro";
                new QRious({ element: document.getElementById('qr-code'), value: eventUrl, size: 160 });
                const message = encodeURIComponent(`¡Estás invitado al Congreso Anual de Tecnología 2025! Regístrate aquí: ${eventUrl}`);
                document.getElementById('whatsapp-share-btn').href = `https://api.whatsapp.com/send?text=${message}`;
                document.getElementById('qr-container').classList.remove('hidden');
            });
        }

        function populateProvidersTable() {
            const providers = [
                { name: 'Gourmet Express', category: 'Catering', contact: 'contacto@gourmet.com', rating: '4.8/5 ⭐' },
                { name: 'Sonido Profesional Live', category: 'Sonido', contact: 'info@sonidopro.uy', rating: '4.9/5 ⭐' },
                { name: 'Deco Dreams', category: 'Decoración', contact: 'ventas@decodreams.com', rating: '4.7/5 ⭐' },
                { name: 'Sabores del Sur', category: 'Catering', contact: 'pedidos@saboresdelsur.uy', rating: '4.9/5 ⭐' },
                { name: 'Luces & Magia', category: 'Iluminación', contact: 'luces@magia.com', rating: '4.6/5 ⭐' }
            ];
            const tableBody = document.getElementById('providers-table-body');
            tableBody.innerHTML = ''; // Clear existing rows
            providers.forEach(p => {
                const row = document.createElement('tr');
                row.className = 'border-b';
                row.innerHTML = `
                    <td class="p-2">${p.name}</td>
                    <td class="p-2">${p.category}</td>
                    <td class="p-2">${p.contact}</td>
                    <td class="p-2">${p.rating}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function initializeApp() {
            const initialTasks = [
                { id: 1, title: 'Definir presupuesto final', description: 'Revisar todas las cotizaciones y cerrar el presupuesto.', category: 'Urgente', column: 'todo' },
                { id: 2, title: 'Enviar invitaciones a ponentes', description: 'Contactar a los 5 ponentes principales.', category: 'Comunicación', column: 'todo' },
                { id: 4, title: 'Comparar cotizaciones de catering', description: 'Analizar opciones de Gourmet Express y Sabores del Sur.', category: 'Proveedores', column: 'inprogress' },
                { id: 5, title: 'Crear página de registro', description: 'Página publicada con formulario de inscripción.', category: 'Completado', column: 'done' },
            ];
            initialTasks.forEach(task => {
                const card = createTaskCard(task.id, task.title, task.description, task.category);
                document.querySelector(`.task-list[data-column-id="${task.column}"]`).appendChild(card);
            });
            
            setupKanbanBoard();
            setupModals();
            setupChatWidget();
            setupInvitations();
            populateProvidersTable();
        }

        initializeApp();
    });
    </script>
</body>
</html>
